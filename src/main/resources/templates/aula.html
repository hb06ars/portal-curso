<!DOCTYPE html>
<html lang="pt-BR" xmlns:th="http://www.thymeleaf.org">

<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Portal Cursos - Dados</title>
    <!-- Video.js CSS -->
    <link href="https://vjs.zencdn.net/7.10.2/video-js.css" rel="stylesheet"/>
    <script src="https://cdn.jsdelivr.net/npm/hls.js@latest"></script>
    <!-- Video.js JS -->
    <script src="https://vjs.zencdn.net/7.10.2/video.js"></script>

    <link href="https://vjs.zencdn.net/7.10.2/video-js.css" rel="stylesheet"/>
    <link rel="stylesheet" th:href="@{/css/style-aula.css}">
</head>

<body>

<!-- HEADER -->
<div th:insert="fragments/header :: header"></div>

<!-- MENU -->
<div th:insert="fragments/menu :: menu"></div>

<!-- CONTEÚDO -->
<div class="container">

    <div class="app">

        <aside class="sidebar">
            <h3 class="course-title">Curso: Desenvolvimento</h3>

            <div id="lessons">
                <div class="lesson" data-src="@{/aula/1}">
                    <div class="meta">
                        <strong>Aula 1 - Introdução</strong>
                        <small>7:07</small>
                    </div>
                </div>

                <div class="lesson" data-src="@{/secure/video/2}" data-title="Aula 2 - HTML Básico" data-desc="Estrutura HTML e tags principais">
                    <div class="meta">
                        <strong>Aula 2 - HTML Básico</strong>
                        <small>12:40</small>
                    </div>
                </div>

                <div class="lesson" data-src="@{/secure/video/3}" data-title="Aula 3 - CSS Básico" data-desc="Estilização e layout">
                    <div class="meta">
                        <strong>Aula 3 - CSS Básico</strong>
                        <small>8:12</small>
                    </div>
                </div>
            </div>

        </aside>

        <main class="player-card">
            <div class="video-wrap">
                <video
                        id="player"
                        class="video-js vjs-default-skin"
                        controls
                        preload="auto"
                        max-width="100%"
                        max-height="100%"
                        data-setup='{"playbackRates": [0.5, 0.75, 1, 1.25, 1.5, 2]}'>
                </video>
            </div>
        </main>

    </div>

</div>
<!-- CONTEÚDO -->

<!-- SCRIPTS -->
<div th:replace="fragments/scripts :: scripts"></div>

</body>

<script>
    document.addEventListener('DOMContentLoaded', () => {

        async function carregarAula(id){
            const tokenUrl = await fetch(`/aula/${id}/token`).then(r => r.text());
            const player = videojs('player');
            player.src({ src: tokenUrl, type: 'application/x-mpegURL' });
            // player.play(); // só se quiser autoplay, cuidado com NotAllowedError
        }

        async function setActiveLesson(idx){
            lessons.forEach(l => l.classList.remove('active'));
            const sel = lessons[idx];
            if(!sel) return;
            sel.classList.add('active');

            const t = sel.getAttribute('data-title');
            const d = sel.getAttribute('data-desc');
            const id = sel.getAttribute('data-src').split('/').pop();
            const tokenUrl = await fetch(`/aula/${id}/token`).then(r => r.text());

            const playerInstance = videojs('player');
            playerInstance.src({ src: tokenUrl, type: 'application/x-mpegURL' });
            // playerInstance.play(); // opcional
            titleEl.textContent = t;
            descEl.textContent = d;
            currentIndex = idx;
            saveState();
        }

        // inicializar a primeira aula
        carregarAula(1);

    });

    const player = videojs('player', {
        playbackRates: [0.5, 0.75, 1, 1.25, 1.5, 2]
    });

</script>

</html>
