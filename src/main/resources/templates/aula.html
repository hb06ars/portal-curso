<!DOCTYPE html>
<html lang="pt-BR" xmlns:th="http://www.thymeleaf.org">

<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Portal Cursos - Dados</title>
    <!-- Video.js CSS -->
    <link href="https://vjs.zencdn.net/7.10.2/video-js.css" rel="stylesheet"/>
    <script src="https://cdn.jsdelivr.net/npm/hls.js@latest"></script>
    <!-- Video.js JS -->
    <script src="https://vjs.zencdn.net/7.10.2/video.js"></script>

    <link href="https://vjs.zencdn.net/7.10.2/video-js.css" rel="stylesheet"/>
    <link rel="stylesheet" th:href="@{/css/style-aula.css}">
</head>

<body>

<!-- HEADER -->
<div th:insert="fragments/header :: header"></div>

<!-- MENU -->
<div th:insert="fragments/menu :: menu"></div>

<!-- CONTEÚDO -->
<div class="container">

<div class="app">
    <header>
        <div class="brand">
            <div class="logo">
                <img src="/img/icone.png" alt="Java Logo">
            </div>
            <div>
                <h1>APRENDENDO A PROGRAMAR</h1>
                <p>Programação Básica para iniciantes.</p>
            </div>
        </div>
        <nav>
            <button id="btn-full" title="Tela cheia">⤢</button>
        </nav>
    </header>

    <aside class="sidebar">
        <h3 class="course-title">Curso: Desenvolvimento</h3>

        <div id="lessons">
            <div class="lesson" data-src="@{/aula/1}">
                <div class="meta">
                    <strong>Aula 1 - Introdução</strong>
                    <small>7:07</small>
                </div>
            </div>

            <div class="lesson" data-src="@{/secure/video/2}" data-title="Aula 2 - HTML Básico" data-desc="Estrutura HTML e tags principais">
                <div class="meta">
                    <strong>Aula 2 - HTML Básico</strong>
                    <small>12:40</small>
                </div>
            </div>

            <div class="lesson" data-src="@{/secure/video/3}" data-title="Aula 3 - CSS Básico" data-desc="Estilização e layout">
                <div class="meta">
                    <strong>Aula 3 - CSS Básico</strong>
                    <small>8:12</small>
                </div>
            </div>
        </div>

    </aside>

    <main class="player-card">
        <div class="video-wrap">
            <video
                    id="player"
                    class="video-js vjs-default-skin"
                    controls
                    preload="auto"
                    width="100%"
                    height="100%"
                    data-setup='{}'>
            </video>

        </div>

        <div class="controls">
            <button id="btn-prev" title="Aula anterior">⟵</button>
            <button id="btn-play" title="Play/Pause">▶</button>
            <button id="btn-next" title="Próxima aula">⟶</button>

            <div class="progress" id="progress"><div id="progress-bar"></div></div>

            <select id="speed" title="Velocidade">
                <option value="0.5">0.5x</option>
                <option value="0.75">0.75x</option>
                <option value="1" selected>1x</option>
                <option value="1.25">1.25x</option>
                <option value="1.5">1.5x</option>
                <option value="2">2x</option>
            </select>
        </div>

        <div class="info">
            <h2 id="title">-</h2>
            <p id="desc">-</p>
        </div>
    </main>
</div>

</div>
<!-- CONTEÚDO -->

<!-- SCRIPTS -->
<div th:replace="fragments/scripts :: scripts"></div>

</body>

<script>
    document.addEventListener('DOMContentLoaded', () => {

        async function carregarAula(id){
            const tokenUrl = await fetch(`/aula/${id}/token`).then(r => r.text());
            const player = videojs('player');
            player.src({ src: tokenUrl, type: 'application/x-mpegURL' });
            // player.play(); // só se quiser autoplay, cuidado com NotAllowedError
        }

        async function setActiveLesson(idx){
            lessons.forEach(l => l.classList.remove('active'));
            const sel = lessons[idx];
            if(!sel) return;
            sel.classList.add('active');

            const t = sel.getAttribute('data-title');
            const d = sel.getAttribute('data-desc');
            const id = sel.getAttribute('data-src').split('/').pop();
            const tokenUrl = await fetch(`/aula/${id}/token`).then(r => r.text());

            const playerInstance = videojs('player');
            playerInstance.src({ src: tokenUrl, type: 'application/x-mpegURL' });
            // playerInstance.play(); // opcional
            titleEl.textContent = t;
            descEl.textContent = d;
            currentIndex = idx;
            saveState();
        }

        // inicializar a primeira aula
        carregarAula(1);

    });
</script>

</html>
